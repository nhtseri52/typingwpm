<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TYPING MASTER ELITE V26</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #445d6e; --accent: #3498db; --bg: #f4f7f9;
            --word-bg: #ffffff; --text-muted: #afb9c3; --correct: #2ecc71;
            --wrong: #e74c3c; --current-bg: #dddddd;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Arial, sans-serif; }
        body { background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Auth Screen */
        .modal { position: fixed; inset: 0; background: #2c3e50; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .auth-box { background: white; padding: 40px; border-radius: 15px; width: 90%; max-width: 400px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); text-align: center; }
        .auth-box h2 { color: var(--primary); margin-bottom: 25px; font-weight: 800; }
        .auth-box input { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #eee; border-radius: 8px; outline: none; font-size: 16px; }
        .btn-auth { width: 100%; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .btn-auth:hover { background: #2980b9; }

        /* Main Layout */
        .app-container { display: flex; flex-direction: column; height: 100vh; width: 100%; padding: 20px; gap: 20px; }
        .sidebar { width: 100%; background: white; border-radius: 12px; display: flex; overflow-x: auto; padding: 10px; gap: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); flex-shrink: 0; }
        .nav-item { padding: 12px 20px; border-radius: 8px; cursor: pointer; white-space: nowrap; font-weight: 600; color: var(--primary); display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .nav-item.active { background: var(--primary); color: white; }

        .content { flex: 1; background: transparent; overflow-y: auto; position: relative; }

        /* 10FastFingers Style Typing Box */
        .typing-wrapper { max-width: 1000px; margin: 0 auto; width: 100%; }
        .word-display-container {
            background: var(--word-bg);
            border-radius: 10px;
            padding: 15px;
            height: 100px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.02);
            position: relative;
        }
        .word-list {
            display: flex;
            flex-wrap: wrap;
            font-size: 28px;
            line-height: 50px;
            transition: transform 0.2s ease;
            position: absolute;
            top: 15px; left: 15px; right: 15px;
        }
        .word-list span { margin: 0 8px; color: #444; border-radius: 4px; padding: 0 5px; }
        .w-active { background: var(--current-bg); }
        .w-correct { color: var(--correct) !important; }
        .w-wrong { color: var(--wrong) !important; background: #ffdada; }

        .control-panel {
            background: #dde4eb;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .input-box { flex: 1; height: 60px; border-radius: 8px; border: 1px solid #ccc; font-size: 24px; padding: 0 20px; outline: none; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .timer-badge { width: 100px; height: 60px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 26px; font-weight: 800; border: 1px solid #ccc; }
        .btn-reset { width: 60px; height: 60px; background: var(--accent); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 20px; }

        /* Pages */
        .page { display: none; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .page.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .post-card { background: #fcfcfc; border: 1px solid #eee; padding: 20px; border-radius: 12px; margin-bottom: 15px; }

        @media (min-width: 768px) {
            .app-container { flex-direction: row; }
            .sidebar { width: 280px; flex-direction: column; overflow-y: auto; height: 100%; }
        }
    </style>
</head>
<body>

    <div id="auth-modal" class="modal">
        <div class="auth-box">
            <h2 id="auth-title">ĐĂNG NHẬP</h2>
            <div id="login-fields">
                <input type="text" id="li-user" placeholder="Tên tài khoản">
                <input type="password" id="li-pass" placeholder="Mật khẩu">
                <button class="btn-auth" onclick="app.login()">VÀO HỆ THỐNG</button>
                <p style="margin-top:20px; cursor:pointer; font-size:14px; color:var(--accent)" onclick="app.toggleAuth(true)">Chưa có nick? Đăng ký ngay</p>
            </div>
            <div id="reg-fields" style="display:none">
                <input type="email" id="rg-email" placeholder="Gmail">
                <input type="text" id="rg-user" placeholder="Tên đăng nhập mới">
                <input type="password" id="rg-pass" placeholder="Mật khẩu">
                <button class="btn-auth" onclick="app.register()">TẠO TÀI KHOẢN</button>
                <p style="margin-top:20px; cursor:pointer; font-size:14px; color:var(--accent)" onclick="app.toggleAuth(false)">Đã có nick? Đăng nhập</p>
            </div>
        </div>
    </div>

    <div class="app-container">
        <div class="sidebar" id="sidebar-nav"></div>

        <div class="content">
            <div id="p-1" class="page active" style="background:transparent; box-shadow:none; padding:0;">
                <div class="typing-wrapper">
                    <div class="word-display-container">
                        <div id="word-list" class="word-list"></div>
                    </div>
                    <div class="control-panel">
                        <input type="text" id="typing-input" class="input-box" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                        <div id="timer" class="timer-badge">60</div>
                        <button class="btn-reset" onclick="app.reset()"><i class="fa-solid fa-sync"></i></button>
                    </div>
                    <div style="margin-top: 20px; color: #666; font-weight: bold;">
                        Kỷ lục của bạn: <span id="user-best-ui" style="color:var(--accent)">0</span> WPM
                    </div>
                </div>
            </div>

            <div id="p-2" class="page">
                <h2 id="h-2">Hướng dẫn</h2>
                <img id="img-guide" src="" style="width:100%; max-width:600px; border-radius:15px; margin:20px 0;">
                <p style="line-height:1.6">Luyện tập gõ phím hàng ngày giúp tăng tốc độ làm việc đáng kể.</p>
            </div>

            <div id="p-3" class="page">
                <h2 id="h-3">Bảng Xếp Hạng</h2>
                <table><thead><tr><th>Hạng</th><th>User</th><th>Tốc độ (WPM)</th></tr></thead><tbody id="rank-tbody"></tbody></table>
            </div>

            <div id="p-4" class="page">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                    <h2 id="h-4">Cộng Đồng</h2>
                    <button class="btn-auth" style="width:auto; padding:10px 20px" onclick="app.addPost()">+ Đăng bài</button>
                </div>
                <div id="post-container"></div>
            </div>

            <div id="p-profile" class="page">
                <h2>HỒ SƠ & MẬT KHẨU</h2>
                <div id="profile-details" style="background:#f9f9f9; padding:25px; border-radius:12px; margin-top:20px; line-height:2.5; border:1px solid #eee;"></div>
            </div>

            <div id="p-god" class="page">
                <h2 style="color:red">QUẢN TRỊ VIÊN</h2>
                <div style="background:#fff3cd; padding:20px; border-radius:10px; margin:20px 0">
                    <h4>Đổi tên mục</h4>
                    Mục: <select id="adm-sel" onchange="app.admLoad()"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select>
                    Tên mới: <input type="text" id="adm-name" style="padding:5px; margin:0 10px;">
                    Ảnh (Mục 2): <input type="text" id="adm-img" style="padding:5px;">
                    <button onclick="app.admSave()" style="padding:5px 15px">Lưu</button>
                </div>
                <h3>Danh sách User</h3>
                <table id="adm-user-table"></table>
            </div>
        </div>
    </div>

<script>
    const WORDS_BANK = "anh em gia đình trường học máy tính điện thoại bàn phím chuột màn hình lập trình thông minh chiến thắng nỗ lực kiên trì thành công hạnh phúc việt nam hà nội sài gòn du lịch biển nước ăn ngon vui vẻ tự tin sáng tạo lịch sử toán vật lý hóa học tiếng anh độc lập tự do tổ quốc bạn bè sinh nhật lễ hội xuân hạ thu đông vở viết kiến thức kỹ năng văn phòng chất lượng tài chính sức khỏe thể thao bóng đá gym phim ảnh mạng xã hội chụp hình nhà khách sạn cà phê trà sữa phở bún cơm trái cây cam táo bia rượu mưa nắng gió mây trời đất sông núi rừng cây hoa lá vàng bạc đồng sắt thép nhôm kính nhựa giấy bút mực thước cặp sách bàn ghế giường tủ bếp nồi chảo chén đĩa muỗng đũa khăn áo quần giày dép mũ nón ví tiền đồng hồ kính mát nhẫn dây chuyền vòng tay tai nghe loa pin sạc cáp wifi web app code game phim nhạc họa ca múa hát nhảy đàn sáo trống kèn vẽ tô màu tranh ảnh tượng đá gạch cát vôi xi măng sơn gỗ tre nứa lá cọ dừa chuối xoài ổi mận đào lê nho dâu bơ mít dứa khế chanh ớt tỏi hành gừng sả tiêu muối đường mì chính dầu mỡ thịt cá tôm cua ốc ếch lươn gà vịt ngỗng heo bò trâu dê cừu ngựa voi hổ báo sư tử gấu khỉ vượn nai hoẵng thỏ chuột mèo chó chim cá sâu bướm ong kiến gián muỗi ruồi nhện rắn rùa thằn lằn".split(" ");

    const app = {
        user: null, words: [], curIdx: 0, timer: null, timeLeft: 60, playing: false, ok: 0, err: 0,
        conf: JSON.parse(localStorage.getItem('v26_conf')) || { m1:"Tập gõ", m2:"Hướng dẫn", m3:"Xếp hạng", m4:"Cộng đồng", img2:"https://vcdn-vnexpress.vnecdn.net/2021/03/17/keyboard-1615969566-8835-1615969623.jpg" },

        init() {
            const ss = localStorage.getItem('v26_ss');
            if(ss) { this.user = JSON.parse(ss); document.getElementById('auth-modal').style.display='none'; this.renderNav(); this.go(1); }
        },
        toggleAuth(reg) {
            document.getElementById('auth-title').innerText = reg ? "ĐĂNG KÝ" : "ĐĂNG NHẬP";
            document.getElementById('login-fields').style.display = reg ? "none" : "block";
            document.getElementById('reg-fields').style.display = reg ? "block" : "none";
        },
        register() {
            const u = document.getElementById('rg-user').value.trim(), p = document.getElementById('rg-pass').value.trim(), e = document.getElementById('rg-email').value.trim();
            if(!u || !p) return alert("Điền đủ thông tin!");
            localStorage.setItem('v26_u_'+u, JSON.stringify({p, e, b:0})); alert("Xong! Đăng nhập đi."); this.toggleAuth(false);
        },
        login() {
            const u = document.getElementById('li-user').value.trim(), p = document.getElementById('li-pass').value.trim();
            if(u === 'nhtseri' && p === 'Locthinh1!') { this.user = {u, isAdmin:true, e:'admin@pro.com', p:'Locthinh1!', b:999}; }
            else {
                const d = JSON.parse(localStorage.getItem('v26_u_'+u));
                if(!d || d.p !== p) return alert("Sai tài khoản/mật khẩu!");
                this.user = {u, isAdmin:false, e:d.e, p:d.p, b:d.b||0};
            }
            localStorage.setItem('v26_ss', JSON.stringify(this.user)); location.reload();
        },
        renderNav() {
            let h = `<div style="padding:15px; font-weight:900; color:var(--accent); font-size:22px; text-align:center">V25 TITAN</div>`;
            [1,2,3,4].forEach(i => h += `<div class="nav-item" id="ni-${i}" onclick="app.go(${i})"><i class="fa-solid fa-chevron-right"></i> ${this.conf['m'+i]}</div>`);
            h += `<div class="nav-item" id="ni-profile" onclick="app.go('profile')"><i class="fa-solid fa-id-card"></i> Hồ sơ cá nhân</div>`;
            if(this.user.isAdmin) h += `<div class="nav-item" id="ni-god" style="color:red" onclick="app.go('god')"><i class="fa-solid fa-user-shield"></i> GOD MODE</div>`;
            h += `<div class="nav-item" style="margin-top:auto; color:orange" onclick="app.logout()"><i class="fa-solid fa-sign-out"></i> Đăng xuất</div>`;
            document.getElementById('sidebar-nav').innerHTML = h;
        },
        go(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('p-'+id).classList.add('active');
            if(document.getElementById('ni-'+id)) document.getElementById('ni-'+id).classList.add('active');
            if(id === 1) this.reset();
            if(id === 2) document.getElementById('img-guide').src = this.conf.img2;
            if(id === 3) this.renderRank();
            if(id === 4) this.renderComm();
            if(id === 'profile') this.renderProfile();
            if(id === 'god') this.renderGod();
            if(this.conf['m'+id]) document.getElementById('h-'+id).innerText = this.conf['m'+id];
        },

        // --- CORE TYPING ENGINE (10FastFingers Style) ---
        reset(customStr = null) {
            clearInterval(this.timer); this.playing = false; this.timeLeft = 60; this.curIdx = 0; this.ok = 0; this.err = 0;
            document.getElementById('timer').innerText = "60";
            document.getElementById('typing-input').value = "";
            document.getElementById('user-best-ui').innerText = this.user.b;
            
            if(customStr) {
                this.words = customStr.split(/\s+/).filter(w => w.length > 0);
            } else {
                this.words = this.generateInfiniteWords(100);
            }
            this.renderWordList();
        },
        generateInfiniteWords(n) {
            let a = []; for(let i=0; i<n; i++) a.push(WORDS_BANK[Math.floor(Math.random()*WORDS_BANK.length)]);
            return a;
        },
        renderWordList() {
            const list = document.getElementById('word-list');
            list.style.transform = `translateY(0)`; // Reset cuộn
            list.innerHTML = this.words.map((w, i) => `<span id="w-${i}">${w}</span>`).join("");
            document.getElementById('w-0').className = 'w-active';
        },
        handleTyping(e) {
            if(!this.playing) {
                this.playing = true;
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    document.getElementById('timer').innerText = this.timeLeft;
                    if(this.timeLeft <= 0) this.finish();
                }, 1000);
            }

            const input = e.target.value;
            if(input.endsWith(" ")) {
                const typed = input.trim().toLowerCase();
                const target = this.words[this.curIdx].toLowerCase();
                const el = document.getElementById('w-'+this.curIdx);

                if(typed === target) { el.className = 'w-correct'; this.ok++; }
                else { el.className = 'w-wrong'; this.err++; }

                this.curIdx++;
                
                // Infinite Random: Nếu sắp hết từ thì nạp thêm
                if(this.curIdx > this.words.length - 10) {
                    const extra = this.generateInfiniteWords(50);
                    this.words = [...this.words, ...extra];
                    const list = document.getElementById('word-list');
                    extra.forEach((w, i) => {
                        const span = document.createElement('span');
                        span.id = `w-${this.words.length - 50 + i}`;
                        span.innerText = w;
                        list.appendChild(span);
                    });
                }

                // Cuộn dòng (10FastFingers Style)
                const nextEl = document.getElementById('w-'+this.curIdx);
                nextEl.className = 'w-active';
                
                // Logic cuộn dòng: Nếu từ mới nằm ở dòng tiếp theo, dịch chuyển list lên
                if(nextEl.offsetTop > 40) {
                    const list = document.getElementById('word-list');
                    list.style.top = (15 - nextEl.offsetTop) + "px";
                }

                e.target.value = "";
            }
        },
        finish() {
            clearInterval(this.timer);
            alert(`KẾT THÚC! Tốc độ: ${this.ok} WPM | Sai: ${this.err}`);
            if(this.ok > this.user.b) {
                this.user.b = this.ok;
                localStorage.setItem('v26_ss', JSON.stringify(this.user));
                let d = JSON.parse(localStorage.getItem('v26_u_'+this.user.u));
                if(d) { d.b = this.ok; localStorage.setItem('v26_u_'+this.user.u, JSON.stringify(d)); }
            }
            // Rank update
            let ranks = JSON.parse(localStorage.getItem('v26_ranks') || "[]");
            let idx = ranks.findIndex(r => r.u === this.user.u);
            if(idx !== -1) { if(this.ok > ranks[idx].w) ranks[idx].w = this.ok; }
            else { ranks.push({u:this.user.u, w:this.ok}); }
            ranks.sort((a,b)=>b.w - a.w);
            localStorage.setItem('v26_ranks', JSON.stringify(ranks.slice(0, 15)));
            this.reset();
        },

        // --- OTHER PAGES ---
        renderProfile() {
            document.getElementById('profile-details').innerHTML = `
                <p><strong>Username:</strong> ${this.user.u}</p>
                <p><strong>Email:</strong> ${this.user.e}</p>
                <p><strong>Mật khẩu:</strong> <span style="background:#333; color:#333; padding:0 10px; border-radius:4px; cursor:pointer;" onclick="this.style.color='white'">${this.user.p}</span> (Click để xem)</p>
                <p><strong>Kỷ lục cá nhân:</strong> <span style="font-size:24px; color:var(--accent); font-weight:800">${this.user.b} WPM</span></p>
            `;
        },
        renderRank() {
            const rs = JSON.parse(localStorage.getItem('v26_ranks') || "[]");
            document.getElementById('rank-tbody').innerHTML = rs.map((r,i)=>`<tr><td>${i+1}</td><td>${r.u}</td><td>${r.w}</td></tr>`).join("");
        },
        renderComm() {
            let ps = JSON.parse(localStorage.getItem('v26_posts') || "[]");
            document.getElementById('post-container').innerHTML = ps.map((p,i)=>`
                <div class="post-card">
                    <p><strong>@${p.u}</strong>: ${p.c}</p>
                    <div style="margin-top:10px;">
                        <button class="btn-reset" style="width:auto; height:auto; padding:5px 15px; font-size:14px; background:${p.likers.includes(this.user.u)?'var(--wrong)':'var(--accent)'}" onclick="app.like(${i})">❤️ ${p.l}</button>
                        <button class="btn-reset" style="width:auto; height:auto; padding:5px 15px; font-size:14px; background:#2ecc71;" onclick="app.tryPost(${i})">Gõ thử bài này</button>
                    </div>
                </div>
            `).join("");
        },
        addPost() {
            const c = prompt("Nhập nội dung chia sẻ:");
            if(c) {
                let ps = JSON.parse(localStorage.getItem('v26_posts') || "[]");
                ps.unshift({u:this.user.u, c, l:0, likers:[]});
                localStorage.setItem('v26_posts', JSON.stringify(ps)); this.renderComm();
            }
        },
        like(i) {
            let ps = JSON.parse(localStorage.getItem('v26_posts'));
            let idx = ps[i].likers.indexOf(this.user.u);
            if(idx===-1) { ps[i].likers.push(this.user.u); ps[i].l++; }
            else { ps[i].likers.splice(idx,1); ps[i].l--; }
            localStorage.setItem('v26_posts', JSON.stringify(ps)); this.renderComm();
        },
        tryPost(i) {
            let ps = JSON.parse(localStorage.getItem('v26_posts'));
            this.go(1); this.reset(ps[i].c);
        },
        renderGod() {
            let h = '<thead><tr><th>User</th><th>Password</th><th>Best</th><th>Xóa</th></tr></thead><tbody>';
            for(let i=0; i<localStorage.length; i++) {
                let k = localStorage.key(i);
                if(k.startsWith('v26_u_')) {
                    let d = JSON.parse(localStorage.getItem(k));
                    h += `<tr><td>${k.replace('v26_u_','')}</td><td>${d.p}</td><td>${d.b}</td><td><button onclick="app.admDel('${k}')">Xóa</button></td></tr>`;
                }
            }
            document.getElementById('adm-user-table').innerHTML = h + '</tbody>';
        },
        admLoad() { document.getElementById('adm-name').value = this.conf['m'+document.getElementById('adm-sel').value]; },
        admSave() {
            let m = document.getElementById('adm-sel').value;
            this.conf['m'+m] = document.getElementById('adm-name').value;
            if(m==='2' && document.getElementById('adm-img').value) this.conf.img2 = document.getElementById('adm-img').value;
            localStorage.setItem('v26_conf', JSON.stringify(this.conf)); location.reload();
        },
        admDel(k) { if(confirm("Xóa User này?")) { localStorage.removeItem(k); this.renderGod(); } },
        logout() { localStorage.removeItem('v26_ss'); location.reload(); }
    };

    document.getElementById('typing-input').oninput = (e) => app.handleTyping(e);
    window.onload = () => app.init();
</script>
</body>
</html>
