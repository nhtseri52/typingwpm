<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TYPING TITAN V25 - UNLIMITED RANDOM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --p: #2980b9; --s: #34495e; --ok: #27ae60; --err: #c0392b; --bg: #f0f2f5; --white: #ffffff; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Auth Modals */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .auth-card { background: var(--white); padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; }
        .auth-card input { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; outline: none; }
        .btn-p { width: 100%; padding: 15px; background: var(--p); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; }

        /* Layout */
        .wrapper { display: flex; flex-direction: column; height: 100vh; padding: 15px; gap: 15px; }
        .nav { background: var(--white); padding: 10px; border-radius: 15px; display: flex; gap: 10px; overflow-x: auto; box-shadow: 0 4px 6px rgba(0,0,0,0.05); flex-shrink: 0; }
        .nav-btn { padding: 12px 20px; border-radius: 10px; cursor: pointer; white-space: nowrap; font-weight: 600; color: var(--s); transition: 0.3s; display: flex; align-items: center; gap: 8px; }
        .nav-btn.active { background: var(--p); color: white; }
        .main { flex: 1; background: var(--white); border-radius: 20px; padding: 25px; overflow-y: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.05); position: relative; }

        /* Typing Zone */
        .word-box { font-size: 26px; line-height: 2; color: #bbb; text-align: left; margin-bottom: 25px; min-height: 150px; overflow: hidden; user-select: none; }
        .w-cur { background: #e1eaf2; color: #333; border-radius: 5px; padding: 0 8px; font-weight: bold; }
        .w-ok { color: var(--ok); }
        .w-err { background: var(--err); color: white; border-radius: 5px; padding: 0 8px; }
        .bar { background: #d6e4f0; padding: 15px; border-radius: 15px; display: flex; gap: 10px; align-items: center; }
        .input-t { flex: 1; height: 55px; border-radius: 10px; border: none; padding: 0 15px; font-size: 20px; outline: none; }
        .timer { background: #2c3e50; color: white; width: 80px; height: 55px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; border-radius: 10px; }

        /* Tables & Lists */
        .page { display: none; } .page.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .post { background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #eee; }

        @media (min-width: 768px) {
            .wrapper { flex-direction: row; padding: 25px; }
            .nav { width: 280px; flex-direction: column; height: 100%; overflow-y: auto; }
        }
    </style>
</head>
<body>

    <div id="m-auth" class="modal" style="display: flex;">
        <div id="login-form" class="auth-card">
            <h2 style="margin-bottom:20px">ĐĂNG NHẬP</h2>
            <input type="text" id="u-in" placeholder="Username">
            <input type="password" id="p-in" placeholder="Password">
            <button class="btn-p" onclick="app.login()">TRUY CẬP</button>
            <p style="margin-top:15px; cursor:pointer; color:var(--p)" onclick="app.toggleAuth(1)">Chưa có nick? Đăng ký</p>
        </div>
        <div id="reg-form" class="auth-card" style="display:none">
            <h2 style="margin-bottom:20px">ĐĂNG KÝ</h2>
            <input type="text" id="ru-in" placeholder="Username mới">
            <input type="password" id="rp-in" placeholder="Mật khẩu">
            <button class="btn-p" onclick="app.register()">TẠO TÀI KHOẢN</button>
            <p style="margin-top:15px; cursor:pointer; color:var(--p)" onclick="app.toggleAuth(0)">Đã có nick? Đăng nhập</p>
        </div>
    </div>

    <div class="wrapper">
        <div class="nav" id="sidebar"></div>
        <div class="main">
            <div id="p-1" class="page active">
                <h1 id="h-1" style="margin-bottom:20px">Luyện Gõ</h1>
                <div id="w-disp" class="word-box"></div>
                <div class="bar">
                    <input type="text" id="t-input" class="input-t" placeholder="Gõ tại đây..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                    <div id="clock" class="timer">1:00</div>
                    <button class="btn-p" style="width:55px" onclick="app.reset()"><i class="fa-solid fa-sync"></i></button>
                </div>
                <div style="margin-top:20px; font-weight:bold; color:var(--p)">Best: <span id="best-ui">0</span> WPM</div>
            </div>

            <div id="p-2" class="page">
                <h1 id="h-2">Hướng dẫn</h1>
                <img id="img-2" src="" style="width:100%; max-width:600px; border-radius:15px; margin:20px 0; display:block;">
                <p>Giữ đúng tư thế và gõ phím bằng 10 ngón tay.</p>
            </div>

            <div id="p-3" class="page">
                <h1 id="h-3">Bảng Xếp Hạng</h1>
                <table><thead><tr><th>Hạng</th><th>User</th><th>WPM Kỷ Lục</th></tr></thead><tbody id="r-table"></tbody></table>
            </div>

            <div id="p-4" class="page">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h1 id="h-4">Cộng Đồng</h1>
                    <button class="btn-p" style="width:auto; padding:10px 20px" onclick="app.post()">+ Đăng bài</button>
                </div>
                <div id="c-list"></div>
            </div>

            <div id="p-profile" class="page">
                <h1>Hồ Sơ</h1>
                <div id="prof-info" style="margin-top:20px; line-height:2"></div>
            </div>

            <div id="p-god" class="page">
                <h1 style="color:var(--err)">GOD MODE - ADMIN ONLY</h1>
                <div style="background:#fff3cd; padding:20px; border-radius:15px; margin:20px 0">
                    <h3>Cấu hình Menu</h3>
                    Mục: <select id="a-sel" onchange="app.loadA()"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select>
                    Tên: <input type="text" id="a-name">
                    Link Ảnh (Mục 2): <input type="text" id="a-img">
                    <button onclick="app.saveA()">Lưu Cấu Hình</button>
                </div>
                <h3>Quản lý User</h3>
                <table id="u-table"></table>
            </div>
        </div>
    </div>

<script>
    const WORDS_DATA = "anh em gia đình trường học máy tính điện thoại bàn phím chuột màn hình lập trình thông minh chiến thắng nỗ lực kiên trì thành công hạnh phúc việt nam hà nội sài gòn du lịch biển nước ăn ngon vui vẻ tự tin sáng tạo lịch sử toán vật lý hóa học tiếng anh độc lập tự do tổ quốc bạn bè sinh nhật lễ hội xuân hạ thu đông vở viết kiến thức kỹ năng văn phòng chất lượng tài chính sức khỏe thể thao bóng đá gym phim ảnh mạng xã hội chụp hình nhà khách sạn cà phê trà sữa phở bún cơm trái cây cam táo bia rượu mưa nắng gió mây trời đất sông núi rừng cây hoa lá vàng bạc đồng sắt thép nhôm kính nhựa giấy bút mực thước cặp sách bàn ghế giường tủ bếp nồi chảo chén đĩa muỗng đũa khăn áo quần giày dép mũ nón ví tiền đồng hồ kính mát nhẫn dây chuyền vòng tay tai nghe loa pin sạc cáp wifi web app code game phim nhạc họa ca múa hát nhảy đàn sáo trống kèn vẽ tô màu tranh ảnh tượng đá gạch cát vôi xi măng sơn gỗ tre nứa lá cọ dừa chuối xoài ổi mận đào lê nho dâu bơ mít dứa khế chanh ớt tỏi hành gừng sả tiêu muối đường mì chính dầu mỡ thịt cá tôm cua ốc ếch lươn gà vịt ngỗng heo bò trâu dê cừu ngựa voi hổ báo sư tử gấu khỉ vượn nai hoẵng thỏ chuột mèo chó chim cá sâu bướm ong kiến gián muỗi ruồi nhện rắn rùa thằn lằn cá vàng cá heo cá mập cá voi".split(" ");

    const app = {
        user: null, words: [], curIdx: 0, timer: null, timeLeft: 60, ok: 0, err: 0, playing: false,
        conf: JSON.parse(localStorage.getItem('v25_cf')) || { m1:"Tập gõ", m2:"Hướng dẫn", m3:"Top", m4:"Cộng đồng", img2:"https://vcdn-vnexpress.vnecdn.net/2021/03/17/keyboard-1615969566-8835-1615969623.jpg" },

        init() {
            const ss = localStorage.getItem('v25_ss');
            if(ss) { this.user = JSON.parse(ss); document.getElementById('m-auth').style.display='none'; this.renderSidebar(); this.switch(1); }
        },
        toggleAuth(isReg) { 
            document.getElementById('login-form').style.display = isReg ? 'none' : 'block';
            document.getElementById('reg-form').style.display = isReg ? 'block' : 'none';
        },
        register() {
            const u = document.getElementById('ru-in').value.trim(), p = document.getElementById('rp-in').value.trim();
            if(!u || !p) return;
            localStorage.setItem('v25_u_'+u, JSON.stringify({p, b:0})); alert("OK!"); this.toggleAuth(0);
        },
        login() {
            const u = document.getElementById('u-in').value.trim(), p = document.getElementById('p-in').value.trim();
            if(u === 'nhtseri' && p === 'Locthinh1!') {
                this.user = {u, isAdmin: true, b: 999};
            } else {
                const d = JSON.parse(localStorage.getItem('v25_u_'+u));
                if(!d || d.p !== p) return alert("Sai!");
                this.user = {u, isAdmin: false, b: d.b||0};
            }
            localStorage.setItem('v25_ss', JSON.stringify(this.user));
            location.reload();
        },
        renderSidebar() {
            let h = `<div style="padding:10px; font-weight:800; color:var(--p); text-align:center">V25 TITAN</div>`;
            [1,2,3,4].forEach(i => h += `<div class="nav-btn" id="nb-${i}" onclick="app.switch(${i})"><i class="fa-solid fa-caret-right"></i> ${this.conf['m'+i]}</div>`);
            h += `<div class="nav-btn" id="nb-profile" onclick="app.switch('profile')"><i class="fa-solid fa-user"></i> Hồ sơ</div>`;
            if(this.user.isAdmin) h += `<div class="nav-btn" id="nb-god" style="color:red" onclick="app.switch('god')"><i class="fa-solid fa-shield-halved"></i> GOD MODE</div>`;
            h += `<div class="nav-btn" style="margin-top:auto; color:orange" onclick="app.logout()"><i class="fa-solid fa-power-off"></i> Thoát</div>`;
            document.getElementById('sidebar').innerHTML = h;
        },
        switch(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('p-'+id).classList.add('active');
            if(document.getElementById('nb-'+id)) document.getElementById('nb-'+id).classList.add('active');
            if(id === 1) this.reset();
            if(id === 2) document.getElementById('img-2').src = this.conf.img2;
            if(id === 3) this.renderRank();
            if(id === 4) this.renderComm();
            if(id === 'profile') document.getElementById('prof-info').innerHTML = `<b>User:</b> ${this.user.u}<br><b>Kỷ lục:</b> ${this.user.b} WPM`;
            if(id === 'god') this.renderAdmin();
            // Update Headers
            if(this.conf['m'+id]) document.getElementById('h-'+id).innerText = this.conf['m'+id];
        },

        // --- RANDOM VÔ HẠN LOGIC ---
        reset(customArr = null) {
            clearInterval(this.timer); this.playing = false; this.timeLeft = 60; this.curIdx = 0; this.ok = 0; this.err = 0;
            document.getElementById('clock').innerText = "1:00"; document.getElementById('t-input').value = "";
            document.getElementById('best-ui').innerText = this.user.b;
            
            if(customArr) {
                this.words = customArr;
            } else {
                // Lấy 100 từ random ban đầu
                this.words = this.getMoreWords(100);
            }
            this.renderWords();
        },
        getMoreWords(count) {
            let arr = [];
            for(let i=0; i<count; i++) arr.push(WORDS_DATA[Math.floor(Math.random()*WORDS_DATA.length)]);
            return arr;
        },
        renderWords() {
            document.getElementById('w-disp').innerHTML = this.words.map((w,i) => `<span id="w-${i}" class="${i===0?'w-cur':''}">${w}</span>`).join(" ");
        },

        handleInput(e) {
            if(!this.playing) {
                this.playing = true;
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    let s = this.timeLeft;
                    document.getElementById('clock').innerText = `0:${s<10?'0'+s:s}`;
                    if(this.timeLeft <= 0) this.finish();
                }, 1000);
            }

            if(e.target.value.endsWith(" ")) {
                let typed = e.target.value.trim().toLowerCase();
                let target = this.words[this.curIdx].toLowerCase();
                let el = document.getElementById('w-'+this.curIdx);

                if(typed === target) { el.className = 'w-ok'; this.ok++; }
                else { el.className = 'w-err'; this.err++; }

                this.curIdx++;
                
                // CƠ CHẾ VÔ HẠN: Nếu gõ gần hết mảng hiện tại, nạp thêm 50 từ nữa
                if(this.curIdx > this.words.length - 10) {
                    let extra = this.getMoreWords(50);
                    this.words = [...this.words, ...extra];
                    this.renderWords(); // Vẽ lại nhưng vẫn giữ vị trí
                }

                // Focus từ tiếp theo
                if(document.getElementById('w-'+this.currentIdx)) {
                    document.querySelectorAll('.w-cur').forEach(c => c.classList.remove('w-cur'));
                    let next = document.getElementById('w-'+this.curIdx);
                    next.classList.add('w-cur');
                    next.scrollIntoView({behavior:'smooth', block:'center'});
                }
                
                e.target.value = "";
            }
        },

        finish() {
            clearInterval(this.timer); alert("Kết quả: " + this.ok + " WPM");
            // Cập nhật kỷ lục cá nhân
            if(this.ok > this.user.b) {
                this.user.b = this.ok;
                localStorage.setItem('v25_ss', JSON.stringify(this.user));
                let d = JSON.parse(localStorage.getItem('v25_u_'+this.user.u));
                if(d) { d.b = this.ok; localStorage.setItem('v25_u_'+this.user.u, JSON.stringify(d)); }
            }
            // Cập nhật BXH (1 người 1 slot)
            let ranks = JSON.parse(localStorage.getItem('v25_ranks') || "[]");
            let idx = ranks.findIndex(r => r.u === this.user.u);
            if(idx !== -1) { if(this.ok > ranks[idx].w) ranks[idx].w = this.ok; }
            else { ranks.push({u: this.user.u, w: this.ok}); }
            ranks.sort((a,b) => b.w - a.w);
            localStorage.setItem('v25_ranks', JSON.stringify(ranks.slice(0, 15)));
            this.reset();
        },

        renderRank() {
            const rs = JSON.parse(localStorage.getItem('v25_ranks') || "[]");
            document.getElementById('r-table').innerHTML = rs.map((r,i) => `<tr><td>${i+1}</td><td>${r.u}</td><td>${r.w}</td></tr>`).join("");
        },
        renderComm() {
            let ps = JSON.parse(localStorage.getItem('v25_posts') || "[]");
            document.getElementById('c-list').innerHTML = ps.map((p,i) => `
                <div class="post">
                    <b>@${p.u}</b>: ${p.c}<br><br>
                    <button class="btn-p" style="width:auto; padding:5px 15px; background:${p.likers.includes(this.user.u)?'var(--err)':'var(--p)'}" onclick="app.like(${i})">❤️ ${p.l}</button>
                    <button class="btn-p" style="width:auto; padding:5px 15px; background:var(--ok)" onclick="app.go(${i})">Gõ bài này</button>
                </div>
            `).join("");
        },
        post() {
            let c = prompt("Nội dung bài đăng:");
            if(c) {
                let ps = JSON.parse(localStorage.getItem('v25_posts') || "[]");
                ps.unshift({u:this.user.u, c, l:0, likers:[]});
                localStorage.setItem('v25_posts', JSON.stringify(ps)); this.renderComm();
            }
        },
        like(i) {
            let ps = JSON.parse(localStorage.getItem('v25_posts'));
            let idx = ps[i].likers.indexOf(this.user.u);
            if(idx === -1) { ps[i].likers.push(this.user.u); ps[i].l++; }
            else { ps[i].likers.splice(idx,1); ps[i].l--; }
            localStorage.setItem('v25_posts', JSON.stringify(ps)); this.renderComm();
        },
        go(i) {
            let ps = JSON.parse(localStorage.getItem('v25_posts'));
            this.switch(1); this.reset(ps[i].c.split(" "));
        },

        // --- ADMIN TOOLS ---
        renderAdmin() {
            let h = '<thead><tr><th>User</th><th>Pass</th><th>Best</th><th>Xóa</th></tr></thead><tbody>';
            for(let i=0; i<localStorage.length; i++){
                let k = localStorage.key(i);
                if(k.startsWith('v25_u_')){
                    let d = JSON.parse(localStorage.getItem(k));
                    h += `<tr><td>${k.replace('v25_u_','')}</td><td>${d.p}</td><td>${d.b}</td><td><button onclick="app.delU('${k}')">Xóa</button></td></tr>`;
                }
            }
            document.getElementById('u-table').innerHTML = h + '</tbody>';
        },
        loadA() { document.getElementById('a-name').value = this.conf['m'+document.getElementById('a-sel').value]; },
        saveA() {
            let m = document.getElementById('a-sel').value;
            this.conf['m'+m] = document.getElementById('a-name').value;
            if(m === '2' && document.getElementById('a-img').value) this.conf.img2 = document.getElementById('a-img').value;
            localStorage.setItem('v25_cf', JSON.stringify(this.conf)); location.reload();
        },
        delU(k) { if(confirm("Xóa?")) { localStorage.removeItem(k); this.renderAdmin(); } },
        logout() { localStorage.removeItem('v25_ss'); location.reload(); }
    };

    document.getElementById('t-input').oninput = (e) => app.handleInput(e);
    window.onload = () => app.init();
</script>
</body>
</html>
