<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V50 TITAN - CỘNG ĐỒNG CHIẾN THẦN</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-main: #f0f2f5; --white: #ffffff; --primary: #337ab7; --success: #5cb85c;
            --text-dark: #333; --text-muted: #777; --border: #ddd;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: var(--bg-main); display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--white); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar-header { padding: 30px 20px; font-size: 22px; font-weight: bold; color: var(--primary); border-bottom: 1px solid #eee; }
        .nav-item { padding: 15px 20px; cursor: pointer; display: flex; align-items: center; gap: 12px; color: #555; font-weight: 500; transition: 0.2s; }
        .nav-item:hover { background: #f9f9f9; }
        .nav-item.active { background: var(--primary); color: white; }
        .nav-item.admin { color: #d9534f; margin-top: auto; border-top: 1px solid #eee; }

        /* MAIN CONTENT */
        .content { flex: 1; padding: 30px; overflow-y: auto; background: var(--white); margin: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .page { display: none; }
        .page.active { display: block; }

        /* TYPING AREA */
        .typing-container { max-width: 900px; margin: 0 auto; }
        .word-box { background: #fdfdfd; border: 1px solid var(--border); border-radius: 6px; padding: 20px; font-size: 28px; line-height: 50px; height: 120px; overflow: hidden; margin-bottom: 20px; position: relative; }
        .word-rail { position: absolute; transition: 0.2s; }
        .word-rail span { margin-right: 15px; padding: 2px 8px; border-radius: 4px; color: #999; }
        .word-rail span.current { background: #ddd; color: #000; }
        .word-rail span.ok { color: var(--success); }
        .word-rail span.err { color: #d9534f; background: #f2dede; }
        
        .input-line { display: flex; gap: 10px; }
        .main-input { flex: 1; padding: 15px; font-size: 24px; border: 2px solid var(--border); border-radius: 6px; outline: none; }
        .main-input:focus { border-color: var(--primary); }
        .timer-box { width: 100px; background: #333; color: white; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: bold; border-radius: 6px; }

        /* COMMUNITY TABLE (10FastFingers Style) */
        .comm-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid var(--bg-main); padding-bottom: 15px; }
        .btn-create { background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        
        .titan-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .titan-table th { text-align: left; padding: 12px; background: #f9f9f9; border-bottom: 2px solid var(--border); color: var(--text-muted); font-size: 14px; }
        .titan-table td { padding: 15px 12px; border-bottom: 1px solid #eee; vertical-align: middle; }
        .status-tag { background: var(--success); color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px; text-transform: uppercase; }
        .text-title { color: var(--primary); font-weight: bold; cursor: pointer; font-size: 16px; text-decoration: none; }
        .text-preview { color: var(--text-muted); font-size: 13px; margin-top: 4px; display: block; }
        .btn-play { background: #f0f0f0; border: 1px solid #ccc; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; }
        .btn-play:hover { background: #e0e0e0; }

        /* MODAL */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background: white; padding: 30px; border-radius: 8px; width: 500px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 4px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">V50 TITAN</div>
        <div class="nav-item active" onclick="App.showPage('home')"><i class="fa-solid fa-keyboard"></i> Luyện tập gõ</div>
        <div class="nav-item" onclick="App.showPage('comm')"><i class="fa-solid fa-users"></i> Chế độ luyện tập</div>
        <div class="nav-item" onclick="App.showPage('rank')"><i class="fa-solid fa-trophy"></i> Bảng vàng</div>
        <div class="nav-item admin" onclick="App.showPage('adm')"><i class="fa-solid fa-lock"></i> QUẢN TRỊ VIÊN</div>
    </div>

    <div class="content">
        <div id="p-home" class="page active">
            <div class="typing-container">
                <h2 id="typing-title" style="margin-bottom: 20px; color: var(--text-muted);">Văn bản mặc định</h2>
                <div class="word-box">
                    <div id="word-rail" class="word-rail"></div>
                </div>
                <div class="input-line">
                    <input type="text" id="typer" class="main-input" placeholder="Gõ tại đây..." autocomplete="off">
                    <div id="timer" class="timer-box">1:00</div>
                    <button class="btn-play" style="width: 60px;" onclick="App.resetTyping()"><i class="fa-solid fa-sync"></i></button>
                </div>
                <div id="res-box" style="margin-top: 30px; display: none; padding: 20px; background: #dff0d8; border-radius: 6px; color: #3c763d;">
                    <h3>Kết quả: <span id="res-wpm">0</span> WPM | Chính xác: <span id="res-acc">0</span>%</h3>
                </div>
            </div>
        </div>

        <div id="p-comm" class="page">
            <div class="comm-header">
                <h2>Chế độ Luyện tập Đánh máy</h2>
                <button class="btn-create" onclick="App.openModal()">+ Tạo văn bản</button>
            </div>
            
            <table class="titan-table">
                <thead>
                    <tr>
                        <th width="80">Trạng thái</th>
                        <th>Tiêu đề</th>
                        <th width="120">Độ dài</th>
                        <th width="120">Đã hoàn thành</th>
                        <th width="100">Hành động</th>
                    </tr>
                </thead>
                <tbody id="comm-table-body">
                    </tbody>
            </table>
        </div>

        <div id="p-rank" class="page"><h1>Bảng Xếp Hạng</h1></div>
        <div id="p-adm" class="page"><h1>Quản Trị Hệ Thống</h1></div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <h3>Tạo văn bản luyện tập mới</h3>
            <div class="form-group" style="margin-top: 20px;">
                <label>Tiêu đề</label>
                <input type="text" id="m-title" placeholder="Ví dụ: Thuyền Quyên, Văn bản tập 1...">
            </div>
            <div class="form-group">
                <label>Nội dung</label>
                <textarea id="m-content" rows="6" placeholder="Nhập nội dung văn bản tại đây..."></textarea>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn-play" onclick="App.closeModal()">Hủy</button>
                <button class="btn-create" onclick="App.savePost()">Lưu và Công khai</button>
            </div>
        </div>
    </div>

    <script>
        const DEFAULT_WORDS = "anh em gia đình trường học máy tính điện thoại bàn phím chuột màn hình lập trình thông minh chiến thắng nỗ lực kiên trì thành công hạnh phúc việt nam hà nội sài gòn du lịch biển nước ăn ngon vui vẻ tự tin".split(" ");

        const App = {
            currentWords: [],
            wordIndex: 0,
            timer: null,
            timeLeft: 60,
            isActive: false,
            correctCount: 0,
            wrongCount: 0,
            currentTextTitle: "Văn bản ngẫu nhiên",

            init() {
                this.renderCommTable();
                this.resetTyping();
                
                document.getElementById('typer').addEventListener('input', (e) => this.handleTyping(e));
            },

            showPage(pageId) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById('p-' + pageId).classList.add('active');
                event.currentTarget.classList.add('active');
                if(pageId === 'comm') this.renderCommTable();
            },

            // TYPING LOGIC
            resetTyping(wordsArr = null, title = "Văn bản ngẫu nhiên") {
                clearInterval(this.timer);
                this.isActive = false;
                this.timeLeft = 60;
                this.wordIndex = 0;
                this.correctCount = 0;
                this.wrongCount = 0;
                this.currentTextTitle = title;
                
                document.getElementById('typing-title').innerText = title;
                document.getElementById('timer').innerText = "1:00";
                document.getElementById('typer').value = "";
                document.getElementById('typer').disabled = false;
                document.getElementById('res-box').style.display = 'none';

                if(!wordsArr) {
                    this.currentWords = [];
                    for(let i=0; i<100; i++) this.currentWords.push(DEFAULT_WORDS[Math.floor(Math.random()*DEFAULT_WORDS.length)]);
                } else {
                    this.currentWords = wordsArr;
                }

                this.renderWords();
            },

            renderWords() {
                const rail = document.getElementById('word-rail');
                rail.style.top = "20px";
                rail.innerHTML = this.currentWords.map((w, i) => `<span id="word-${i}">${w}</span>`).join('');
                document.getElementById('word-0').className = 'current';
            },

            handleTyping(e) {
                if(!this.isActive && e.target.value.trim().length > 0) {
                    this.isActive = true;
                    this.startTimer();
                }

                if(e.target.value.endsWith(" ")) {
                    const input = e.target.value.trim();
                    const target = this.currentWords[this.wordIndex];
                    const el = document.getElementById('word-' + this.wordIndex);

                    if(input === target) {
                        el.className = 'ok';
                        this.correctCount++;
                    } else {
                        el.className = 'err';
                        this.wrongCount++;
                    }

                    this.wordIndex++;
                    const nextEl = document.getElementById('word-' + this.wordIndex);
                    if(nextEl) {
                        nextEl.className = 'current';
                        // Cuộn dòng nếu cần
                        if(nextEl.offsetTop > 40) {
                            document.getElementById('word-rail').style.top = (20 - nextEl.offsetTop) + "px";
                        }
                    }
                    e.target.value = "";
                }
            },

            startTimer() {
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    let m = Math.floor(this.timeLeft / 60);
                    let s = this.timeLeft % 60;
                    document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                    
                    if(this.timeLeft <= 0) {
                        clearInterval(this.timer);
                        this.finish();
                    }
                }, 1000);
            },

            finish() {
                document.getElementById('typer').disabled = true;
                const acc = Math.round((this.correctCount / (this.correctCount + this.wrongCount)) * 100) || 0;
                document.getElementById('res-wpm').innerText = this.correctCount;
                document.getElementById('res-acc').innerText = acc;
                document.getElementById('res-box').style.display = 'block';
                
                // Cập nhật số lượt hoàn thành cho bài post
                if(this.currentTextTitle !== "Văn bản ngẫu nhiên") {
                    let posts = JSON.parse(localStorage.getItem('titan_posts') || "[]");
                    let idx = posts.findIndex(p => p.title === this.currentTextTitle);
                    if(idx !== -1) {
                        posts[idx].done = (posts[idx].done || 0) + 1;
                        localStorage.setItem('titan_posts', JSON.stringify(posts));
                    }
                }
            },

            // COMMUNITY LOGIC
            openModal() { document.getElementById('modal').style.display = 'flex'; },
            closeModal() { document.getElementById('modal').style.display = 'none'; },

            savePost() {
                const title = document.getElementById('m-title').value.trim();
                const content = document.getElementById('m-content').value.trim();
                if(!title || !content) return alert("Vui lòng nhập đủ!");

                const posts = JSON.parse(localStorage.getItem('titan_posts') || "[]");
                posts.unshift({
                    title: title,
                    content: content,
                    wordCount: content.split(/\s+/).length,
                    charCount: content.length,
                    done: 0,
                    date: 'Today'
                });
                localStorage.setItem('titan_posts', JSON.stringify(posts));
                this.renderCommTable();
                this.closeModal();
                // Clear form
                document.getElementById('m-title').value = "";
                document.getElementById('m-content').value = "";
            },

            renderCommTable() {
                const posts = JSON.parse(localStorage.getItem('titan_posts') || "[]");
                const tbody = document.getElementById('comm-table-body');
                
                // Bài mẫu nếu trống
                if(posts.length === 0) {
                    posts.push({title: "Thuyền Quyên", content: "Xa xa bóng người thương, thấp thoáng trước thềm nhà đang đưa dâu...", wordCount: 16, charCount: 80, done: 4, date: 'Today'});
                }

                tbody.innerHTML = posts.map((p, i) => `
                    <tr>
                        <td><span class="status-tag">công khai</span></td>
                        <td>
                            <a class="text-title" onclick="App.playPost(${i})">${p.title}</a>
                            <span class="text-preview">${p.content.substring(0, 60)}...</span>
                        </td>
                        <td>
                            <div style="font-size:13px;"><b>${p.wordCount} từ</b></div>
                            <div style="font-size:11px; color:#999;">${p.charCount} kí tự</div>
                        </td>
                        <td><b style="color:#777;">${p.done}</b></td>
                        <td><button class="btn-play" onclick="App.playPost(${i})">Gõ thử</button></td>
                    </tr>
                `).join('');
            },

            playPost(i) {
                const posts = JSON.parse(localStorage.getItem('titan_posts') || "[]");
                const target = posts[i];
                this.showPage('home');
                this.resetTyping(target.content.split(/\s+/), target.title);
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>
