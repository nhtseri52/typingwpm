<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V25 TITAN - HỆ THỐNG GÕ PHÍM CHIẾN THẦN</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- DESIGN SYSTEM BY TITAN --- */
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --bg: #f8f9fc;
            --white: #ffffff;
            --sidebar-w: 280px;
            --shadow: 0 12px 40px rgba(0,0,0,0.1);
            --radius: 16px;
            --font-main: 'Inter', 'Segoe UI', Tahoma, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: var(--font-main); }
        body { background: var(--bg); color: var(--primary); height: 100vh; display: flex; overflow: hidden; }

        /* --- AUTHENTICATION UI (FULL TIẾNG VIỆT) --- */
        .auth-overlay {
            position: fixed; inset: 0; background: linear-gradient(45deg, #0f2027, #203a43, #2c5364);
            z-index: 9999; display: flex; align-items: center; justify-content: center;
        }
        .auth-box {
            background: var(--white); width: 450px; border-radius: 24px; padding: 50px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.5); text-align: center;
        }
        .auth-tabs { display: flex; gap: 10px; background: #f0f2f5; padding: 6px; border-radius: 12px; margin-bottom: 30px; }
        .auth-tab {
            flex: 1; padding: 12px; cursor: pointer; border-radius: 8px; font-weight: 700;
            transition: 0.3s; color: #666;
        }
        .auth-tab.active { background: var(--white); color: var(--accent); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

        .form-group { text-align: left; margin-bottom: 20px; }
        .form-group label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #555; }
        .t-input {
            width: 100%; padding: 14px 18px; border: 2px solid #edf2f7; border-radius: 12px;
            font-size: 16px; outline: none; transition: 0.3s;
        }
        .t-input:focus { border-color: var(--accent); background: #fdfdfd; }
        .btn-prime {
            width: 100%; padding: 16px; background: var(--accent); color: white; border: none;
            border-radius: 12px; font-size: 16px; font-weight: 800; cursor: pointer; transition: 0.3s;
        }
        .btn-prime:hover { filter: brightness(1.1); transform: translateY(-2px); }

        /* --- SIDEBAR LAYOUT --- */
        .sidebar {
            width: var(--sidebar-w); background: var(--white); height: 100%;
            border-right: 1px solid #e3e8ee; display: flex; flex-direction: column; flex-shrink: 0;
        }
        .sidebar-header { padding: 40px 20px; border-bottom: 1px solid #f8fafc; }
        .brand { font-size: 22px; font-weight: 900; color: var(--accent); text-align: center; letter-spacing: -0.5px; }

        .nav-list { flex: 1; padding: 25px 15px; overflow-y: auto; }
        .nav-item {
            display: flex; align-items: center; gap: 15px; padding: 14px 20px; border-radius: 12px;
            cursor: pointer; font-weight: 600; color: #64748b; margin-bottom: 10px; transition: 0.3s;
        }
        .nav-item i { font-size: 18px; width: 25px; }
        .nav-item:hover { background: #f1f5f9; color: var(--primary); }
        .nav-item.active { background: var(--accent); color: white; box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3); }
        .nav-item.adm-only { color: var(--danger); }
        .nav-item.adm-only.active { background: var(--danger); color: white; }

        .user-footer { padding: 20px; border-top: 1px solid #f1f5f9; background: #fafbfc; }
        .u-name { font-weight: 800; font-size: 15px; }

        /* --- CONTENT AREA --- */
        .main-content { flex: 1; padding: 40px; overflow-y: auto; position: relative; }
        .view { display: none; animation: slideUp 0.5s ease forwards; max-width: 1200px; margin: 0 auto; }
        .view.active { display: block; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- TYPING INTERFACE (CHẤT LƯỢNG CAO) --- */
        .engine-card { background: var(--white); border-radius: 24px; padding: 45px; box-shadow: var(--shadow); position: relative; }
        .word-display {
            background: #fdfdfd; border: 1px solid #f1f5f9; border-radius: 18px;
            padding: 30px; height: 140px; overflow: hidden; position: relative;
            font-size: 34px; line-height: 65px; margin-bottom: 35px; color: #94a3b8;
        }
        .word-rail { position: absolute; top: 30px; left: 30px; right: 30px; transition: 0.25s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        .word-rail span { margin-right: 22px; padding: 2px 10px; border-radius: 8px; }
        .word-rail .cur { background: #e2e8f0; color: #1e293b; font-weight: 700; }
        .word-rail .ok { color: var(--success); }
        .word-rail .err { color: var(--danger); background: #fff1f2; }

        .control-panel { display: flex; gap: 20px; }
        .input-box {
            flex: 1; height: 75px; border: 3px solid #f1f5f9; border-radius: 18px;
            padding: 0 30px; font-size: 30px; outline: none; transition: 0.3s;
        }
        .input-box:focus { border-color: var(--accent); box-shadow: 0 0 20px rgba(52, 152, 219, 0.1); }
        .timer-badge {
            width: 140px; background: #1e293b; color: white; border-radius: 18px;
            display: flex; align-items: center; justify-content: center; font-size: 36px; font-weight: 900;
        }

        /* --- RESULTS OVERLAY --- */
        .res-overlay {
            position: absolute; inset: 0; background: rgba(255,255,255,0.98);
            display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 50; border-radius: 24px;
        }
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; margin: 40px 0; width: 85%; }
        .stat-node { background: #f8fafc; padding: 30px; border-radius: 20px; text-align: center; border: 1px solid #f1f5f9; }
        .stat-node h4 { color: #64748b; font-size: 14px; text-transform: uppercase; margin-bottom: 10px; }
        .stat-node p { font-size: 52px; font-weight: 900; color: var(--accent); }

        /* --- ADMIN & COMMUNITY TABLES --- */
        .card { background: var(--white); border-radius: 20px; padding: 30px; box-shadow: var(--shadow); margin-bottom: 30px; }
        .titan-table { width: 100%; border-collapse: collapse; }
        .titan-table th { text-align: left; padding: 18px; color: #64748b; font-size: 13px; border-bottom: 2px solid #f1f5f9; }
        .titan-table td { padding: 18px; border-bottom: 1px solid #f8fafc; font-size: 15px; }
        .titan-table tr:hover { background: #fafbfc; }

        .badge { padding: 6px 14px; border-radius: 10px; font-size: 12px; font-weight: 700; text-transform: uppercase; }
        .bg-admin { background: #fef3c7; color: #92400e; }
        .bg-user { background: #dcfce7; color: #166534; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="auth-screen" class="auth-overlay">
        <div class="auth-box">
            <h1 style="margin-bottom: 10px; color: var(--accent);">V25 TITAN</h1>
            <p style="color: #888; margin-bottom: 30px; font-size: 14px;">Hệ thống gõ phím chuyên nghiệp toàn diện</p>
            
            <div class="auth-tabs">
                <div class="auth-tab active" id="tab-login" onclick="Titan.toggleAuth('login')">Đăng nhập</div>
                <div class="auth-tab" id="tab-reg" onclick="Titan.toggleAuth('reg')">Đăng ký</div>
            </div>

            <div id="auth-form-body">
                <div class="form-group">
                    <label>Tài khoản</label>
                    <input type="text" id="au-u" class="t-input" placeholder="Tên đăng nhập">
                </div>
                <div class="form-group">
                    <label>Mật khẩu</label>
                    <input type="password" id="au-p" class="t-input" placeholder="••••••••">
                </div>
                <div id="reg-extra" style="display: none;">
                    <div class="form-group">
                        <label>Xác nhận mật khẩu</label>
                        <input type="password" id="au-p2" class="t-input" placeholder="Gõ lại mật khẩu">
                    </div>
                </div>
                <button class="btn-prime" id="auth-btn" onclick="Titan.handleAuth()">BẮT ĐẦU TRẢI NGHIỆM</button>
                <p style="margin-top: 25px; color: #999; font-size: 12px;">Admin mặc định: <b>nhtseri</b> / <b>Locthinh1!</b></p>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div class="sidebar-header">
            <div class="brand" id="brand-text">GÕ PHÍM VIỆT NAM</div>
        </div>
        <div class="nav-list" id="sidebar-nav">
            </div>
        <div class="user-footer">
            <p class="u-name" id="footer-uname">Guest</p>
            <span style="font-size: 12px; color: #94a3b8; cursor: pointer;" onclick="Titan.logout()">Đăng xuất hệ thống</span>
        </div>
    </div>

    <main class="main-content">
        
        <div id="v-home" class="view active">
            <div class="engine-card">
                <div id="res-screen" class="res-overlay">
                    <h2 style="font-size: 32px; color: var(--primary);">KẾT QUẢ GÕ PHÍM</h2>
                    <div class="stat-grid">
                        <div class="stat-node"><h4>Tốc độ</h4><p id="res-wpm">0</p><small>WPM</small></div>
                        <div class="stat-node"><h4>Chính xác</h4><p id="res-acc">0%</p></div>
                        <div class="stat-node"><h4>Từ đúng</h4><p id="res-ok" style="color:var(--success)">0</p></div>
                    </div>
                    <button class="btn-prime" style="width: 250px;" onclick="Titan.resetEngine()">THỬ LẠI LẦN NỮA</button>
                </div>

                <div class="word-display">
                    <div id="word-rail" class="word-rail"></div>
                </div>

                <div class="control-panel">
                    <input type="text" id="typer" class="input-box" placeholder="Gõ từ tại đây để bắt đầu tính giờ..." autocomplete="off">
                    <div id="timer" class="timer-badge">1:00</div>
                    <button class="btn-prime" style="width: 75px; margin: 0;" onclick="Titan.resetEngine()">
                        <i class="fa-solid fa-sync"></i>
                    </button>
                </div>
            </div>

            <div style="margin-top: 40px; display: flex; gap: 40px;">
                <div class="stat-node" style="flex:1; padding: 20px;">
                    <h4 style="text-align: left;">Kỷ lục cá nhân</h4>
                    <p id="ui-best" style="text-align: left; font-size: 35px;">0 WPM</p>
                </div>
                <div class="stat-node" style="flex:1; padding: 20px;">
                    <h4 style="text-align: left;">Tổng từ đã gõ</h4>
                    <p id="ui-total" style="text-align: left; font-size: 35px;">0</p>
                </div>
            </div>
        </div>

        <div id="v-comm" class="view">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h1>CỘNG ĐỒNG VĂN BẢN</h1>
                <button class="btn-prime" style="width: auto; padding: 12px 25px;" onclick="Titan.postText()">
                    <i class="fa-solid fa-plus"></i> Chia sẻ văn bản mới
                </button>
            </div>
            <div id="comm-container"></div>
        </div>

        <div id="v-rank" class="view">
            <h1>BẢNG VÀNG CAO THỦ</h1>
            <div class="card" style="margin-top: 25px;">
                <table class="titan-table">
                    <thead>
                        <tr>
                            <th>Hạng</th>
                            <th>Người chơi</th>
                            <th>Tốc độ (WPM)</th>
                            <th>Ngày đạt được</th>
                        </tr>
                    </thead>
                    <tbody id="rank-tbody"></tbody>
                </table>
            </div>
        </div>

        <div id="v-pro" class="view">
            <h1>HỒ SƠ CỦA TÔI</h1>
            <div class="card" id="profile-card" style="margin-top: 25px; line-height: 2.5;"></div>
        </div>

        <div id="v-adm" class="view">
            <h1 style="color: var(--danger);"><i class="fa-solid fa-shield-halved"></i> QUẢN TRỊ VIÊN TITAN</h1>
            
            <div class="stat-grid" style="margin: 25px 0;">
                <div class="stat-node"><h4>Tổng User</h4><p id="adm-user-count">0</p></div>
                <div class="stat-node"><h4>Bài đăng</h4><p id="adm-post-count">0</p></div>
                <div class="stat-node"><h4>Hệ thống</h4><p style="font-size: 25px; margin-top: 15px;">ỔN ĐỊNH</p></div>
            </div>

            <div class="card">
                <h3>Tùy chỉnh thương hiệu</h3>
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <input type="text" id="adm-brand-input" class="t-input" placeholder="Đổi tên sidebar...">
                    <button class="btn-prime" style="width: auto; margin:0;" onclick="Titan.admSaveBrand()">LƯU</button>
                </div>
            </div>

            <h3>Quản lý người dùng</h3>
            <div class="card" style="margin-top: 15px;">
                <table class="titan-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Mật khẩu</th>
                            <th>Vai trò</th>
                            <th>Kỷ lục</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="adm-user-tbody"></tbody>
                </table>
            </div>
        </div>

    </main>

    <script>
        /* --- KHO TỪ VỰNG KHỔNG LỒ (ĐÃ FIX BUG) --- */
        const DICTIONARY = "anh em gia đình trường học máy tính điện thoại bàn phím chuột màn hình lập trình thông minh chiến thắng nỗ lực kiên trì thành công hạnh phúc việt nam hà nội sài gòn du lịch biển nước ăn ngon vui vẻ tự tin sáng tạo lịch sử toán vật lý hóa học tiếng anh độc lập tự do tổ quốc bạn bè sinh nhật lễ hội xuân hạ thu đông vở viết kiến thức kỹ năng văn phòng chất lượng tài chính sức khỏe thể thao bóng đá gym phim ảnh mạng xã hội chụp hình nhà khách sạn cà phê trà sữa phở bún cơm trái cây cam táo bia rượu mưa nắng gió mây trời đất sông núi rừng cây hoa lá vàng bạc đồng sắt thép nhôm kính nhựa giấy bút mực thước cặp sách bàn ghế giường tủ bếp nồi chảo chén đĩa muỗng đũa khăn áo quần giày dép mũ nón ví tiền đồng hồ kính mát nhẫn dây chuyền vòng tay tai nghe loa pin sạc cáp wifi web app code game phim nhạc họa ca múa hát nhảy đàn sáo trống kèn vẽ tô màu tranh ảnh tượng đá gạch cát vôi xi măng sơn gỗ tre nứa lá cọ dừa chuối xoài ổi mận đào lê nho dâu bơ mít dứa khế chanh ớt tỏi hành gừng sả tiêu muối đường mì chính dầu mỡ thịt cá tôm cua ốc ếch lươn gà vịt ngỗng heo bò trâu dê cừu ngựa voi hổ báo sư tử gấu khỉ vượn nai hoẵng thỏ chuột mèo chó chim cá sâu bướm ong kiến gián muỗi ruồi nhện rắn rùa thằn lằn".split(" ");

        /* --- TITAN CORE ENGINE --- */
        const Titan = {
            u: null, words: [], ci: 0, time: 60, active: false, timer: null, ok: 0, err: 0, mode: 'login',

            init() {
                // Mặc định Admin
                if(!localStorage.getItem('tt_u_nhtseri')) {
                    localStorage.setItem('tt_u_nhtseri', JSON.stringify({u:'nhtseri', p:'Locthinh1!', role:'admin', best:0, total:0}));
                }

                const session = localStorage.getItem('tt_session');
                if(session) {
                    this.u = JSON.parse(session);
                    document.getElementById('auth-screen').style.display = 'none';
                    this.renderNav();
                    this.resetEngine();
                    document.getElementById('footer-uname').innerText = this.u.u;
                    const b = localStorage.getItem('tt_brand');
                    if(b) document.getElementById('brand-text').innerText = b;
                }
            },

            toggleAuth(m) {
                this.mode = m;
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                document.getElementById('tab-'+m).classList.add('active');
                document.getElementById('reg-extra').style.display = (m === 'reg' ? 'block' : 'none');
                document.getElementById('auth-btn').innerText = (m === 'login' ? 'ĐĂNG NHẬP NGAY' : 'TẠO TÀI KHOẢN');
            },

            handleAuth() {
                const user = document.getElementById('au-u').value.trim();
                const pass = document.getElementById('au-p').value.trim();

                if(!user || !pass) return alert("Vui lòng không bỏ trống!");

                if(this.mode === 'login') {
                    const data = localStorage.getItem('tt_u_' + user);
                    if(!data) return alert("Tài khoản không tồn tại!");
                    const pData = JSON.parse(data);
                    if(pData.p !== pass) return alert("Mật khẩu sai rồi bro!");
                    this.u = pData;
                } else {
                    const pass2 = document.getElementById('au-p2').value.trim();
                    if(pass !== pass2) return alert("Mật khẩu không khớp!");
                    if(localStorage.getItem('tt_u_'+user)) return alert("Tên này đã có người dùng!");
                    this.u = { u: user, p: pass, role: 'user', best: 0, total: 0 };
                    localStorage.setItem('tt_u_' + user, JSON.stringify(this.u));
                }

                localStorage.setItem('tt_session', JSON.stringify(this.u));
                location.reload();
            },

            logout() {
                localStorage.removeItem('tt_session');
                location.reload();
            },

            renderNav() {
                const menus = [
                    { id: 'home', icon: 'keyboard', text: 'Luyện tập gõ' },
                    { id: 'rank', icon: 'trophy', text: 'Bảng vàng' },
                    { id: 'comm', icon: 'users', text: 'Cộng đồng' },
                    { id: 'pro', icon: 'circle-user', text: 'Hồ sơ cá nhân' }
                ];
                if(this.u.role === 'admin') menus.push({ id: 'adm', icon: 'shield-halved', text: 'QUẢN TRỊ VIÊN', adm: true });

                document.getElementById('sidebar-nav').innerHTML = menus.map(m => `
                    <div class="nav-item ${m.id === 'home' ? 'active' : ''} ${m.adm ? 'adm-only' : ''}" 
                         id="ni-${m.id}" onclick="Titan.go('${m.id}')">
                        <i class="fa-solid fa-${m.icon}"></i> ${m.text}
                    </div>
                `).join('');
            },

            go(page) {
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById('v-' + page).classList.add('active');
                document.getElementById('ni-' + page).classList.add('active');

                if(page === 'rank') this.loadRank();
                if(page === 'comm') this.loadComm();
                if(page === 'pro') this.loadPro();
                if(page === 'adm') this.loadAdm();
            },

            /* --- TYPING LOGIC (FIXED SCROLL) --- */
            resetEngine(customWords = null) {
                clearInterval(this.timer);
                this.active = false; this.time = 60; this.ci = 0; this.ok = 0; this.err = 0;
                document.getElementById('timer').innerText = "1:00";
                document.getElementById('typer').value = "";
                document.getElementById('typer').disabled = false;
                document.getElementById('res-screen').style.display = 'none';
                
                // Update stats UI
                document.getElementById('ui-best').innerText = this.u.best + " WPM";
                document.getElementById('ui-total').innerText = this.u.total;

                this.words = customWords || [];
                if(!customWords) {
                    for(let i=0; i<250; i++) this.words.push(DICTIONARY[Math.floor(Math.random()*DICTIONARY.length)]);
                }

                const rail = document.getElementById('word-rail');
                rail.style.top = "30px";
                rail.innerHTML = this.words.map((w, i) => `<span id="word-${i}">${w}</span>`).join('');
                document.getElementById('word-0').className = 'cur';
                setTimeout(() => document.getElementById('typer').focus(), 100);
            },

            handleTyping(e) {
                if(!this.active && e.target.value.length > 0) {
                    this.active = true;
                    this.timer = setInterval(() => {
                        this.time--;
                        document.getElementById('timer').innerText = `0:${this.time < 10 ? '0'+this.time : this.time}`;
                        if(this.time <= 0) this.finish();
                    }, 1000);
                }

                if(e.target.value.endsWith(" ")) {
                    const typed = e.target.value.trim().toLowerCase();
                    const target = this.words[this.ci].toLowerCase();
                    const el = document.getElementById('word-' + this.ci);

                    if(typed === target) { el.className = 'ok'; this.ok++; }
                    else { el.className = 'err'; this.err++; }

                    this.ci++;
                    const next = document.getElementById('word-' + this.ci);
                    if(next) {
                        next.className = 'cur';
                        // Logic cuộn dòng thông minh
                        if(next.offsetTop > 40) {
                            document.getElementById('word-rail').style.top = (30 - next.offsetTop) + "px";
                        }
                    }
                    e.target.value = "";
                }
            },

            finish() {
                clearInterval(this.timer);
                document.getElementById('typer').disabled = true;
                const acc = Math.round((this.ok / (this.ok + this.err)) * 100) || 0;
                
                document.getElementById('res-wpm').innerText = this.ok;
                document.getElementById('res-acc').innerText = acc + "%";
                document.getElementById('res-ok').innerText = this.ok;
                document.getElementById('res-screen').style.display = 'flex';

                // Lưu data
                this.u.total += this.ok;
                if(this.ok > this.u.best) {
                    this.u.best = this.ok;
                    this.updateGlobalRank();
                }
                localStorage.setItem('tt_u_' + this.u.u, JSON.stringify(this.u));
                localStorage.setItem('tt_session', JSON.stringify(this.u));
            },

            /* --- COMMUNITY --- */
            postText() {
                const txt = prompt("Dán văn bản bạn muốn chia sẻ (Tiếng Việt):");
                if(txt && txt.length > 10) {
                    const posts = JSON.parse(localStorage.getItem('tt_posts') || "[]");
                    posts.unshift({ author: this.u.u, content: txt, date: new Date().toLocaleDateString() });
                    localStorage.setItem('tt_posts', JSON.stringify(posts));
                    this.loadComm();
                }
            },

            loadComm() {
                const posts = JSON.parse(localStorage.getItem('tt_posts') || "[]");
                document.getElementById('comm-container').innerHTML = posts.map((p, i) => `
                    <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <p style="font-size:12px; color:#888;">Người đăng: <b>${p.author}</b> • ${p.date}</p>
                            <p style="font-size:16px; font-weight:600; margin-top:5px;">${p.content.substring(0, 80)}...</p>
                        </div>
                        <button class="btn-prime" style="width:auto; padding:10px 20px; font-size:13px;" onclick="Titan.playComm(${i})">LUYỆN TẬP BÀI NÀY</button>
                    </div>
                `).join('') || '<p align="center">Chưa có bài chia sẻ nào.</p>';
            },

            playComm(i) {
                const posts = JSON.parse(localStorage.getItem('tt_posts'));
                const arr = posts[i].content.split(/\s+/);
                this.go('home');
                this.resetEngine(arr);
            },

            /* --- RANKING --- */
            updateGlobalRank() {
                let ranks = JSON.parse(localStorage.getItem('tt_ranks') || "[]");
                let f = ranks.findIndex(r => r.u === this.u.u);
                if(f !== -1) ranks[f].s = this.u.best;
                else ranks.push({ u: this.u.u, s: this.u.best, d: new Date().toLocaleDateString() });
                ranks.sort((a,b) => b.s - a.s);
                localStorage.setItem('tt_ranks', JSON.stringify(ranks.slice(0, 20)));
            },

            loadRank() {
                const rs = JSON.parse(localStorage.getItem('tt_ranks') || "[]");
                document.getElementById('rank-tbody').innerHTML = rs.map((r, i) => `
                    <tr><td><b>#${i+1}</b></td><td>${r.u}</td><td style="color:var(--accent); font-weight:800;">${r.s} WPM</td><td>${r.d}</td></tr>
                `).join('');
            },

            /* --- PROFILE --- */
            loadPro() {
                document.getElementById('profile-card').innerHTML = `
                    <p>Tên tài khoản: <b style="color:var(--accent)">${this.u.u}</b></p>
                    <p>Vai trò hệ thống: <span class="badge bg-${this.u.role}">${this.u.role}</span></p>
                    <p>Tốc độ cao nhất: <b>${this.u.best} WPM</b></p>
                    <p>Tổng tích lũy: <b>${this.u.total} từ</b></p>
                    <p>Mật khẩu: <span style="background:#333; color:#333; cursor:pointer;" onclick="this.style.color='white'">${this.u.p}</span> <small>(Click để xem)</small></p>
                `;
            },

            /* --- ADMIN --- */
            loadAdm() {
                const users = Object.keys(localStorage).filter(k => k.startsWith('tt_u_')).map(k => JSON.parse(localStorage.getItem(k)));
                const posts = JSON.parse(localStorage.getItem('tt_posts') || "[]");
                
                document.getElementById('adm-user-count').innerText = users.length;
                document.getElementById('adm-post-count').innerText = posts.length;

                document.getElementById('adm-user-tbody').innerHTML = users.map(u => `
                    <tr>
                        <td><b>${u.u}</b></td>
                        <td><code>${u.p}</code></td>
                        <td><span class="badge bg-${u.role}">${u.role}</span></td>
                        <td>${u.best} WPM</td>
                        <td>
                            ${u.u !== 'nhtseri' ? `<button onclick="Titan.admDeleteUser('${u.u}')" style="color:red; border:none; background:none; cursor:pointer; font-weight:bold;">Xóa</button>` : 'System'}
                        </td>
                    </tr>
                `).join('');
            },

            admDeleteUser(user) {
                if(confirm(`Bro chắc chắn muốn xóa user [${user}] không?`)) {
                    localStorage.removeItem('tt_u_' + user);
                    this.loadAdm();
                }
            },

            admSaveBrand() {
                const val = document.getElementById('adm-brand-input').value.trim();
                if(val) {
                    localStorage.setItem('tt_brand', val);
                    document.getElementById('brand-text').innerText = val;
                    alert("Đã cập nhật thương hiệu!");
                }
            }
        };

        // EVENT LISTENER
        document.getElementById('typer').addEventListener('input', (e) => Titan.handleTyping(e));
        window.onload = () => Titan.init();
    </script>
</body>
</html>
